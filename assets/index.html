<!doctype html>
<html>

<head>
	<title>Progress Bot</title>
</head>
<link rel="stylesheet" href="style.css">
<script src="/socket.io/socket.io.js"></script>
<script src="https://code.jquery.com/jquery-1.11.1.js"></script>
<link href="https://fonts.googleapis.com/css?family=Raleway:400,300,600,800,900" rel="stylesheet" type="text/css">
<script src="/progressbar.min.js"></script>
<script>
	var socket = io();

	console.log("Starting");
  var stats = {};
  //var [encode], [title], [episode], [time], [tl], [ts], [edit], [qc];


	/**socket.on("irc message", function(msg) {
		console.log("NEW MESSAGE");
		$('#messages')
			.append($('<li>')
				.text(msg));
	});*/


	socket.on("init-stats", function(val) {
    if (val["command"] !== "title" && val["command"] !== "episode")
    {
			//console.log(val["command"]);

		var dispCommand = "";
		if (val["command"] === "tl")
			dispCommand = "translation";
		else if (val["command"] === "edit")
			dispCommand = "editing";
		else if (val["command"] === "ts")
			dispCommand = "typesetting";
		else if (val["command"] === "time")
			dispCommand = "timing";
		else if (val["command"] === "encode")
			dispCommand = "encoding";
		else dispCommand = val["command"];



		stats[val["command"]] = new ProgressBar.Line('#pb-'+val["command"], {
			easing: 'easeInOut',
			color: '#4286f4',
			trailColor: '#eee',
			trailWidth: 1,
			svgStyle: {width: '100%', height: '30%'},
			text: {
				style: {
					autoStyleContainer: false,
					color: '#999',
					fontFamily: '"Raleway", Helvetica, sans-serif',
					fontSize: '3.8vh',
					position: 'absolute'
				}
			},
			step: (state, bar) => { bar.setText(val["command"] + ": " + Math.round(bar.value() * 100) + ' %');}
		});
		stats[val["command"]].animate(val["value"]);
  }
  else {
		console.log(val["value"]);
		if (val["command"] === "title")
		{
    	$("#pb-title").text(val["value"]);
		}
		else {
			$("#pb-episode").text("Episode: " + val["value"]);
		}
  }
	});


	socket.on("update-stats", function(val) {
		if (val["command"] !== "title" && val["command"] !== "episode")
		{
			stats[val["command"]].animate(val["value"]/100);
		}
		else {
			if (val["command"] === "title")
			{
	    	$("#pb-title").text(val["value"]);
			}
			else {
				$("#pb-episode").text("Episode: " + val["value"]);
			}
		}
	});

</script>

<body>
	<div id="outer-container">
		<ul id="messages"></ul>
		<div class="pb-div" id="pb-title"></div>
	  <div class="pb-div" id="pb-episode"></div>
		<div id="inner-container">
			<div class="pb-div" id="pb-tl"></div>
		  <div class="pb-div" id="pb-tlc"></div>
		  <div class="pb-div" id="pb-edit"></div>
			<div class="pb-div" id="pb-ts"></div>
		  <div class="pb-div" id="pb-time"></div>
		  <div class="pb-div" id="pb-encode"></div>
		  <div class="pb-div" id="pb-qc"></div>
		</div>
</div>

</body>

</html>
